

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> index.ts</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Global</h3><ul><li><a href="global.html#createElement">createElement</a></li><li><a href="global.html#destroyElement">destroyElement</a></li><li><a href="global.html#get3dsReturnUrl">get3dsReturnUrl</a></li><li><a href="global.html#getGatewayUrl">getGatewayUrl</a></li><li><a href="global.html#handle3ds">handle3ds</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#loadAirwallex">loadAirwallex</a></li><li><a href="global.html#loadAirwallexJs">loadAirwallexJs</a></li><li><a href="global.html#redirectToCheckout">redirectToCheckout</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>index.ts</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Airwallex, {
  init as initFn,
  redirectToCheckout as redirectToCheckoutFn,
  createElement as createElementFn,
  destroyElement as destroyElementFn,
  getElement as getElementFn,
  confirmPaymentIntent as confirmPaymentIntentFn,
  confirmPaymentIntentWithSavedCard as confirmPaymentIntentWithSavedCardFn,
  createPaymentMethod as createPaymentMethodFn,
  getPaymentIntent as getPaymentIntentFn,
  createPaymentConsent as createPaymentConsentFn,
  AirwallexEnv,
  ElementOptionsTypeMap,
} from '../types/airwallex';

import { ElementType } from '../types/index';
import {
  getBrowserInfo as getBrowserInfoFn,
  getDeviceFingerprint as getDeviceFingerprintFn,
  get3dsReturnUrl as get3dsReturnUrlFn,
  handle3ds as handle3dsFn,
} from '../types/fraud';
import { loadAirwallex as loadAirwallexFn } from '../types/index';

const ENV_HOST = {
  prod: 'checkout.airwallex.com',
  demo: 'checkout-demo.airwallex.com',
  staging: 'checkout-staging.airwallex.com',
  /**
   * Below env only for the npm package development
   * Should not using them when integrate with Airwallex
   */
  qa: 'checkoutui.qa.awx.im',
  preview: 'checkoutui.preview.awx.im',
  dev: 'localhost:3000',
};

declare global {
  interface Window {
    Airwallex: Airwallex;
    ReactNativeWebView: {
      postMessage: (message: string) => void;
    };
  }
}

/**
 * @typedef {import('../types/index').InitOptions} InitOptions
 */

/**
 * @function getGatewayUrl
 * @param {AirwallexEnv}  env - Indicate which airwallex integration env your merchant site would like to connect with
 * @return {string} gateway url
 */
export const getGatewayUrl = (env: AirwallexEnv): string => `https://${ENV_HOST[env] || ENV_HOST.prod}`;

const STATIC_JS_URL = '/assets/elements.bundle.min.js';

/**
 * @function loadAirwallexJs
 * @param {string} gatewayUrl url
 * @return {HTMLScriptElement}
 */
export const loadAirwallexJs = (gatewayUrl: string): HTMLScriptElement => {
  const script = document.createElement('script');
  script.src = `${gatewayUrl}${STATIC_JS_URL}`;

  const headOrBody = document.head || document.body;

  if (!headOrBody) {
    throw new Error('Airwallex payment scripts requires a &lt;head> or &lt;body> html element in order to be loaded.');
  }

  headOrBody.appendChild(script);

  return script;
};

/**
 * @typedef {import('../types/index').InitOptions} InitOptions
 */

/**
 * @function loadAirwallex
 * @param {InitOptions} options
 */
export const loadAirwallex: typeof loadAirwallexFn = async (options) => {
  if (typeof window === 'undefined') {
    return null;
  }

  if (window.Airwallex) {
    return window.Airwallex;
  }

  const MAX_RETRY_COUNT = 3;
  let RETRY_COUNT = 0;
  const sleep = () => new Promise((resolve) => window.setTimeout(resolve, 500));

  const tryToResolve = async (): Promise&lt;Airwallex> => {
    const script: HTMLScriptElement =
      document.querySelector(`script[src="${STATIC_JS_URL}"], script[src="${STATIC_JS_URL}/"]`) ||
      loadAirwallexJs(getGatewayUrl(options?.env || 'prod'));

    return new Promise((resolve, reject) => {
      script.addEventListener('load', () => {
        if (window.Airwallex) {
          window.Airwallex.init(options);
          resolve(window.Airwallex);
        } else {
          reject(new Error('Failed to load Airwallex on load event'));
        }
      });

      script.addEventListener('error', () => {
        reject(new Error('Failed to load Airwallex scripts'));
        script.remove &amp;&amp; script.remove();
      });
    });
  };

  while (RETRY_COUNT &lt; MAX_RETRY_COUNT) {
    try {
      return await tryToResolve();
    } catch (error) {
      RETRY_COUNT++;
      await sleep();
    }
  }

  return null;
};

/**
 * @function init
 * @param {InitOptions} options
 */
export const init: typeof initFn = (options) => {
  if (!window.Airwallex) {
    console.error('Please loadAirwallex() before init();');
  } else {
    window.Airwallex.init(options);
  }
};

/**
 * @function redirectToCheckout
 * @param {HostPaymentPage} props
 * @return {void}
 */
export const redirectToCheckout: typeof redirectToCheckoutFn = (props) => {
  if (!window.Airwallex) {
    console.error('Please loadAirwallex() before redirectToCheckout();');
  } else {
    return window.Airwallex.redirectToCheckout(props);
  }
};

/**
 * @typedef {import('../types/index').ElementType} ElementType
 * @typedef {import('../types/airwallex').ElementOptionsTypeMap} ElementOptionsTypeMap
 */

/**
 * @function createElement
 * @param {ElementType} type
 * @param {ElementOptionsTypeMap&lt;ElementType>} options
 * @return {void}
 */
export const createElement: typeof createElementFn = (type, options) => {
  if (!window.Airwallex) {
    console.error('Please loadAirwallex() before createElement();');
    return null;
  } else {
    return window.Airwallex.createElement(type, options);
  }
};

/**
 * @function destroyElement
 * @param {ElementType} type
 * @return {boolean}
 */
export const destroyElement: typeof destroyElementFn = (type) => {
  if (!window.Airwallex) {
    console.error('Please loadAirwallex() before destroyElement();');
    return false;
  } else {
    return window.Airwallex.destroyElement(type);
  }
};

export const getElement: typeof getElementFn = (type) => {
  if (!window.Airwallex) {
    console.error('Please loadAirwallex() before getElement();');
    return null;
  } else {
    return window.Airwallex.getElement(type);
  }
};

export const confirmPaymentIntent: typeof confirmPaymentIntentFn = async (data) => {
  if (!window.Airwallex) {
    const err = 'Please loadAirwallex() before confirmPaymentIntent();';
    console.error(err);
    throw new Error(err);
  } else {
    return window.Airwallex.confirmPaymentIntent(data);
  }
};

export const confirmPaymentIntentWithSavedCard: typeof confirmPaymentIntentWithSavedCardFn = async (data) => {
  if (!window.Airwallex) {
    const err = 'Please loadAirwallex() before confirmPaymentIntentWithSavedCard();';
    console.error(err);
    throw new Error(err);
  } else {
    return window.Airwallex.confirmPaymentIntentWithSavedCard(data);
  }
};

export const createPaymentMethod: typeof createPaymentMethodFn = async (client_secret, data) => {
  if (!window.Airwallex) {
    const err = 'Please loadAirwallex() before createPaymentMethod();';
    console.error(err);
    throw new Error(err);
  } else {
    return window.Airwallex.createPaymentMethod(client_secret, data);
  }
};

export const getPaymentIntent: typeof getPaymentIntentFn = async (id, client_secret) => {
  if (!window.Airwallex) {
    const err = 'Please loadAirwallex() before getPaymentIntent();';
    console.error(err);
    throw new Error(err);
  } else {
    return window.Airwallex.getPaymentIntent(id, client_secret);
  }
};

export const createPaymentConsent: typeof createPaymentConsentFn = async (data) => {
  if (!window.Airwallex) {
    const err = 'Please loadAirwallex() before createPaymentConsent();';
    console.error(err);
    throw new Error(err);
  } else {
    return window.Airwallex.createPaymentConsent(data);
  }
};

export const getBrowserInfo: typeof getBrowserInfoFn = (data) => {
  return window.Airwallex.getBrowserInfo(data);
};

export const getDeviceFingerprint: typeof getDeviceFingerprintFn = (data) => {
  return window.Airwallex.getDeviceFingerprint(data);
};

/**
 * @deprecated this function would need exactly the same API version for merchant and element, so better to not use it
 */
export const get3dsReturnUrl: typeof get3dsReturnUrlFn = (data) => {
  return window.Airwallex.get3dsReturnUrl(data);
};

/**
 * @deprecated this function would need exactly the same API version for merchant and element, so better to not use it
 */
export const handle3ds: typeof handle3dsFn = (data) => {
  return window.Airwallex.handle3ds(data);
};
</code></pre>
        </article>
    </section>




            </div>
            
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
